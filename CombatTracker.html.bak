<!DOCTYPE html>
<html>
	<head>

		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>

		<script> 
		    $(function(){
		      $("#Header1").load("Header.html"); 
			  $("#PH_modules_list").load("Modules.html"); 
		    });
		</script> 

		<script> 
			function nextTurn(){
				var found = false;
				$("#order tr").each(function(idx, tr){
					if ($(tr).hasClass("active")){
						$(tr).removeClass("active");
						if (idx == $("#order tr").length - 1){
							$($("#order tr").get(1)).addClass("active");
						} else {
							$($("#order tr").get(idx + 1)).addClass("active");
						}
						found = true;
						return false;
					}
				});

				if (!found) {
					$("#order tr:nth-child(2)").addClass("active");
				}
			}

			function add(){
				var initiative = 0;
				if ($("#initiative").val() == -1) {
					initiative = parseInt(Math.random() * 20 + 1);
				} else {
					initiative = $("#initiative").val();
				}

				var item = "";

				item += "<tr><td>";
				item += initiative ;
				item += "</td><td>";
				item += $("#name").val();
				item += "</td><td>";
				item += $("#health").val();
				item += "</td><td>";
				item += "<button  id=\"add1_but\" type=\"button\" onclick=\"addHealth(this, 1)\">+1HP</button >"
				item += "<button  id=\"add5_but\" type=\"button\" onclick=\"addHealth(this, 5)\">+5HP</button >"
				item += "<button  id=\"add10_but\" type=\"button\" onclick=\"addHealth(this, 10)\">+10HP</button >"
				item += "<button  id=\"add-1_but\" type=\"button\" onclick=\"addHealth(this, -1)\">-1HP</button >"
				item += "<button  id=\"add-5_but\" type=\"button\" onclick=\"addHealth(this, -5)\">-5HP</button >"
				item += "<button  id=\"add-10_but\" type=\"button\" onclick=\"addHealth(this, -10)\">-10HP</button >"
				item += "<input  id=\"remove_but\" type=\"button\" onclick=\"removeChar(this)\">Remove</input >"
				item += "<input  id=\"copy_but\" type=\"button\" onclick=\"duplicate(this)\">Add Copy</input >"
				item += "<input  id=\"changeini_but\" type=\"button\" onclick=\"change(this, 0)\">Change Initiative</input >"
				item += "<input  id=\"change_name_but\" type=\"button\" onclick=\"change(this, 1)\">Change Name</input >"
				item += "</td></tr>";

				$("#order").append(item);

				sort();
			}

			function sort() {
				var items = $("#order").find("tr:gt(0)").toArray();
				items.sort(function(a,b){
					var keyA = $(a).children('td').html()
					var keyB = $(b).children('td').html()

					if (parseInt(keyA) < parseInt(keyB)) return -1;
					if (parseInt(keyA) > parseInt(keyB)) return 1;
					return 0;
				});
				items.reverse();
				for (var i = 0; i < items.length; i++){$("#order").append(items[i])}
			}

			function removeChar(sender) {
				$(sender).parent().parent().remove();
			}

			function addHealth(sender, amount) {
				var row = $(sender).parent().parent()
				var children = row.children();
				var newHealth = parseInt($(children[2]).html()) + amount
				children[2] = "<td>" + newHealth + "</td>";
				$($(sender).parent().parent().children()[2]).replaceWith(children[2]);
			}

			function duplicate(sender) {
				$("#order").append("<tr>" + $(sender).parent().parent().html() + "</tr>");
				sort();
			}

			function change(sender, column) {
				var value = prompt("Enter new value", "");
				if (value != null) {
				    var row = $(sender).parent().parent()
					var children = row.children();
					children[column] = "<td>" + value + "</td>";
					$($(sender).parent().parent().children()[column]).replaceWith(children[column]);
				}
				sort();
			}
		</script>

		<title>DND TOOLS</title> 
	</head>
	<link rel="stylesheet" type="text/css" href="DNDStyle.css">
	<body>
		<div Id = "Header1">
			<!-- import header goes here -->
		</div>
		<div class= "body_content">
			<div class= "PH_ads">
				<p>w/e here</p>
			</div>
			<div class= "PH_main_content" id="main">

				<table id="order" border="1">
					<tr>
						<th>Initiative</th>
						<th>Name</th>
						<th>Health</th>
						<th>Actions</th>
					</tr>
				</table>

				<button id="turn" type="button" onclick="nextTurn()">Next Turn</button>

				name: <input type="text" id="name">
				initiative: <input type="text" id="initiative">
				health: <input type="text" id="health">
				<button id="add" type="button" onclick="add()">add</button>

			</div>
			<div class= "PH_modules_list"id="PH_modules_list">
			</div>
		</div>
		<div class = "footer">
			<div class ="navbar">
				<p>Navbar</p>
			</div>
		</div>
	</body>
</html>
